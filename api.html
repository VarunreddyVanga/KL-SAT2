<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Live Geolocation Map</title>
  <!-- Leaflet CSS and JavaScript -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" integrity="sha512-cv8qRF1FAM6SHrD6h/UqOXPTxc0CJAL9wgtUtkqsmX0Fxx+1F9/2aU4XZORyBqVWDV/XuR9/z2P9V4j/aZ5EThQ==" crossorigin=""/>
  <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js" integrity="sha512-n4DzqBYizbMWKUuj9MO/3kYD1li0M2WX9F8FLIg8d6EqwYJl1Lb0DPCpVU5FsPOUHcxcKWJXS9DIiZZ4PWYg31A==" crossorigin=""></script>
</head>
<body>
  <div id="map" style="height: 400px;"></div>

  <script>
    function initMap() {
      const map = L.map('map').setView([0, 0], 2); // Initial center and zoom level

      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: 'Â© OpenStreetMap contributors'
      }).addTo(map);

      function updateMap(apiData) {
        if (apiData && apiData.entries && apiData.entries.length > 0) {
          const latestEntry = apiData.entries[0];
          const newLatLng = [parseFloat(latestEntry.lat), parseFloat(latestEntry.lng)];

          // If the map has markers, remove them
          if (map.markers) {
            map.markers.forEach(marker => marker.removeFrom(map));
          }

          // Add a marker at the updated coordinates
          const marker = L.marker(newLatLng).addTo(map);
          map.markers = [marker];

          // Set the map view to the updated coordinates
          map.setView(newLatLng);
        }
      }

      function fetchData() {
        fetch('http://localhost:3000/api/data')
          .then(response => response.json())
          .then(data => {
            updateMap(data);
          })
          .catch(error => {
            console.error('Error fetching live data:', error);
          });
      }

      // Fetch live data initially
      fetchData();

      // Schedule periodic updates (every 10 seconds in this example)
      setInterval(fetchData, 10000); // Fetch data every 10 seconds
    }

    // Initialize the map when the page is loaded
    document.addEventListener('DOMContentLoaded', initMap);
  </script>
</body>
</html>
